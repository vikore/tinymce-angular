/*!
 * TinyDrive
 *
 * Copyright 2010-2021 Tiny Technologies, Inc. All rights reserved.
 *
 * Version: 1.4.1-91
 */
!function(){"use strict";function a(n){var e=n;return{get:function(){return e},set:function(n){e=n}}}function f(){}function u(n){return function(){return n()}}function i(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,n))}}function l(n){return function(){return n}}function r(n){return n}var c=l(!1),s=l(!0),n=function(){return d},d={fold:function(n,e){return n()},is:c,isSome:c,isNone:s,getOr:o,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(void 0),or:o,orThunk:t,map:n,each:f,bind:n,exists:c,forall:s,filter:n,equals:e,equals_:e,toArray:function(){return[]},toString:l("none()")};function e(n){return n.isNone()}function t(n){return n()}function o(n){return n}function m(n,e){for(var t=E(n),r=0,o=t.length;r<o;r++){var u=t[r];e(n[u],u)}}function p(n,t){return D(n,function(n,e){return{k:e,v:t(n,e)}})}function h(t){return function(n,e){t[e]=n}}function g(n,e){var t,r,o,u={},i={};return t=e,r=h(u),o=h(i),m(n,function(n,e){(t(n,e)?r:o)(n,e)}),{t:u,f:i}}function v(n,t){var r=[];return m(n,function(n,e){r.push(t(n,e))}),r}function y(n,e){return R(n,e)?S.from(n[e]):S.none()}var b,w,O,T,x=function(t){function n(){return o}function e(n){return n(t)}var r=l(t),o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:s,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return x(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?o:d},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(c,function(n){return e(t,n)})}};return o},S={some:x,none:n,from:function(n){return null==n?d:x(n)}},F="undefined"!=typeof window?window:Function("return this;")(),E=Object.keys,U=Object.hasOwnProperty,D=function(n,t){var r={};return m(n,function(n,e){e=t(n,e);r[e.k]=e.v}),r},_=function(n){return v(n,function(n){return n})},R=function(n,e){return U.call(n,e)},k={},I={exports:k};w=k,O=I,T=b=void 0,function(n){"object"==typeof w&&void 0!==O?O.exports=n():"function"==typeof b&&b.amd?b([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}(function(){return function r(o,u,i){function a(e,n){if(!u[e]){if(!o[e]){var t="function"==typeof T&&T;if(!n&&t)return t(e,!0);if(f)return f(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}t=u[e]={exports:{}},o[e][0].call(t.exports,function(n){return a(o[e][1][n]||n)},t,t.exports,r,o,u,i)}return u[e].exports}for(var f="function"==typeof T&&T,n=0;n<i.length;n++)a(i[n]);return a}({1:[function(n,e,t){var r,o,e=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(n){try{return r.call(null,e,0)}catch(n){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(n){o=i}}();var f,c=[],s=!1,l=-1;function d(){s&&f&&(s=!1,f.length?c=f.concat(c):l=-1,c.length&&m())}function m(){if(!s){var n=a(d);s=!0;for(var e=c.length;e;){for(f=c,c=[];++l<e;)f&&f[l].run();l=-1,e=c.length}f=null,s=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(n){try{return o.call(null,e)}catch(n){return o.call(this,e)}}}(n)}}function p(n,e){this.fun=n,this.array=e}function h(){}e.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];c.push(new p(n,e)),1!==c.length||s||a(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=h,e.addListener=h,e.once=h,e.off=h,e.removeListener=h,e.removeAllListeners=h,e.emit=h,e.prependListener=h,e.prependOnceListener=h,e.listeners=function(n){return[]},e.binding=function(n){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(n){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],2:[function(n,l,e){!function(e){function r(){}function u(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(n,this)}function o(t,r){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,u._immediateFn(function(){var n,e=1===t._state?r.onFulfilled:r.onRejected;if(null!==e){try{n=e(t._value)}catch(n){return void a(r.promise,n)}i(r.promise,n)}else(1===t._state?i:a)(r.promise,t._value)})):t._deferreds.push(r)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof u)return e._state=3,e._value=n,void f(e);if("function"==typeof t)return void s((r=t,o=n,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=n,f(e)}catch(n){a(e,n)}var r,o}function a(n,e){n._state=2,n._value=e,f(n)}function f(n){2===n._state&&0===n._deferreds.length&&u._immediateFn(function(){n._handled||u._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)o(n,n._deferreds[e]);n._deferreds=null}function c(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function s(n,e){var t=!1;try{n(function(n){t||(t=!0,i(e,n))},function(n){t||(t=!0,a(e,n))})}catch(n){if(t)return;t=!0,a(e,n)}}var n,t;n=this,t=setTimeout,u.prototype.catch=function(n){return this.then(null,n)},u.prototype.then=function(n,e){var t=new this.constructor(r);return o(this,new c(n,e,t)),t},u.all=function(n){var a=Array.prototype.slice.call(n);return new u(function(o,u){if(0===a.length)return o([]);var i=a.length;for(var n=0;n<a.length;n++)!function e(t,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var r=n.then;if("function"==typeof r)return void r.call(n,function(n){e(t,n)},u)}a[t]=n,0==--i&&o(a)}catch(n){u(n)}}(n,a[n])})},u.resolve=function(e){return e&&"object"==typeof e&&e.constructor===u?e:new u(function(n){n(e)})},u.reject=function(t){return new u(function(n,e){e(t)})},u.race=function(o){return new u(function(n,e){for(var t=0,r=o.length;t<r;t++)o[t].then(n,e)})},u._immediateFn="function"==typeof e?function(n){e(n)}:function(n){t(n,0)},u._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},u._setImmediateFn=function(n){u._immediateFn=n},u._setUnhandledRejectionFn=function(n){u._unhandledRejectionFn=n},void 0!==l&&l.exports?l.exports=u:n.Promise||(n.Promise=u)}.call(this,n("timers").setImmediate)},{timers:3}],3:[function(f,n,c){!function(n,e){var r=f("process/browser.js").nextTick,t=Function.prototype.apply,o=Array.prototype.slice,u={},i=0;function a(n,e){this._id=n,this._clearFn=e}c.setTimeout=function(){return new a(t.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new a(t.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(n){n.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},c.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},c._unrefActive=c.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout(function(){n._onTimeout&&n._onTimeout()},e))},c.setImmediate="function"==typeof n?n:function(n){var e=i++,t=!(arguments.length<2)&&o.call(arguments,1);return u[e]=!0,r(function(){u[e]&&(t?n.apply(null,t):n.call(null),c.clearImmediate(e))}),e},c.clearImmediate="function"==typeof e?e:function(n){delete u[n]}}.call(this,f("timers").setImmediate,f("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var r=n("promise-polyfill"),n="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:n.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});var j=I.exports.boltExport,P=function(t){return{is:function(n){return t===n},isValue:s,isError:c,getOr:l(t),getOrThunk:l(t),getOrDie:l(t),or:function(n){return P(t)},orThunk:function(n){return P(t)},fold:function(n,e){return e(t)},map:function(n){return P(n(t))},mapError:function(n){return P(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOptional:function(){return S.some(t)}}},L=function(t){return{is:c,isValue:c,isError:s,getOr:r,getOrThunk:function(n){return n()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return L(t)},mapError:function(n){return L(n(t))},each:f,bind:function(n){return L(t)},exists:c,forall:s,toOptional:S.none}},A={value:P,error:L,fromOption:function(n,e){return n.fold(function(){return L(e)},P)}},M=function(){return(M=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function C(n,e){for(var t=0,r=e.length,o=n.length;t<r;t++,o++)n[o]=e[t];return n}function N(n){return!(null==n)}function B(n,e){return n=n,e=e,-1<Un.call(n,e)}function z(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t))return!0;return!1}function G(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var u=n[o];r[o]=e(u,o)}return r}function J(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t)}function V(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var u=n[r];e(u,r)&&t.push(u)}return t}function q(n,e,t){return J(n,function(n){t=e(t,n)}),t}function H(n,e){return function(n,e,t){for(var r=0,o=n.length;r<o;r++){var u=n[r];if(e(u,r))return S.some(u);if(t(u,r))break}return S.none()}(n,e,c)}function W(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Tn(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);Dn.apply(e,n[t])}return e}function K(n,e){return W(G(n,e))}function X(n){return e=n,(n=0)<=n&&n<e.length?S.some(e[n]):S.none();var e}function Y(n){setTimeout(function(){throw n},0)}function $(n){return Ln(jn(n))}function Z(i,n){return n(function(r){var o=[],u=0;0===i.length?r([]):J(i,function(n,e){var t;n.get((t=e,function(n){o[t]=n,++u>=i.length&&r(o)}))})})}function Q(n){return Mn.nu(function(e){n().then(function(n){return e(A.value(n))}).catch(function(n){return e(A.error(n))})})}function nn(n,e){var t=String(e).toLowerCase();return H(n,function(n){return n.search(t)})}function en(n,e){return-1!==n.indexOf(e)}function tn(n){return window.matchMedia(n).matches}function rn(n,e){n.dom.appendChild(e.dom)}function on(n,e){var t=n.dom;m(e,function(n,e){!function(n,e,t){if(!(wn(t)||xn(t)||Fn(t)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}(t,e,n)})}function un(n){function e(){return n.stopPropagation()}function t(){return n.preventDefault()}var r=Nn.fromDom(function(n){if(fe()&&N(n.target)){var e=Nn.fromDom(n.target);if(ae(e)&&ce(e)&&n.composed&&n.composedPath){e=n.composedPath();if(e)return X(e)}}return S.from(n.target)}(n).getOr(n.target)),o=i(t,e);return{target:r,x:n.clientX,y:n.clientY,stop:e,prevent:t,kill:o,raw:n}}function an(n,e,t,r,o){var u,i,r=(u=t,i=r,function(n){u(n)&&i(un(n))});return n.dom.addEventListener(e,r,o),{unbind:function(r){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.concat(n);return r.apply(null,t)}}(le,n,e,r,o)}}function fn(n,e,t){return an(n,e,de,t,!1)}function cn(t,r){return Mn.nu(function(n){var e=Nn.fromTag("script");on(e,M({src:t},r)),fn(e,"load",function(){n(A.value(e))}),fn(e,"error",function(){n(A.error("Failed to load script: "+t))}),rn(se(Nn.fromDom(document)),e)})}function sn(n,r,o){return y(n,r).fold(function(){return e=n,t=r,cn(o,{}).bindResult(function(n){return A.fromOption(y(e,t),'Could not find "'+t+'" in the given namespace')});var e,t},Mn.pure)}function ln(n){var e=V(n,function(n){return n.isError()});return(0<e.length?e:n)[0]}function dn(n){return n=[sn(y(F,"tinymce").or(y(F,"tinydrive")).getOrThunk(function(){var n={};return F.tinydrive=n}),"_assetManagerProvider",n.js),(t=n.css,Mn.nu(function(n){var e=Nn.fromTag("link");on(e,{rel:"stylesheet",href:t}),fn(e,"load",function(){n(A.value(e))}),fn(e,"error",function(){n(A.error("Failed to load css: "+t))}),rn(Nn.fromDom(document.head),e)}))],Z(n,jn).map(ln).toLazy();var t}var mn,pn,hn,gn,vn,yn=function(t){return function(n){return n=typeof(e=n),(null===e?"null":"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n)===t;var e}},bn=function(e){return function(n){return typeof n===e}},wn=yn("string"),On=yn("object"),Tn=yn("array"),xn=bn("boolean"),Sn=bn("function"),Fn=bn("number"),En=Array.prototype.slice,Un=Array.prototype.indexOf,Dn=Array.prototype.push,_n=Sn(Array.from)?Array.from:function(n){return En.call(n)},Rn=function(n){var t=S.none(),e=[],r=function(n){o()?i(n):e.push(n)},o=function(){return t.isSome()},u=function(n){J(n,i)},i=function(e){t.each(function(n){setTimeout(function(){e(n)},0)})};return n(function(n){o()||(t=S.some(n),u(e),e=[])}),{get:r,map:function(t){return Rn(function(e){r(function(n){e(t(n))})})},isReady:o}},kn={nu:Rn,pure:function(e){return Rn(function(n){n(e)})}},In=function(t){function n(n){t().then(n,Y)}return{map:function(n){return In(function(){return t().then(n)})},bind:function(e){return In(function(){return t().then(function(n){return e(n).toPromise()})})},anonBind:function(n){return In(function(){return t().then(function(){return n.toPromise()})})},toLazy:function(){return kn.nu(n)},toCached:function(){var n=null;return In(function(){return n=null===n?t():n})},toPromise:t,get:n}},jn=function(n){return In(function(){return new j(n)})},Pn=function(n){return In(function(){return j.resolve(n)})},Ln=function(u){return M(M({},u),{toCached:function(){return Ln(u.toCached())},bindFuture:function(e){return Ln(u.bind(function(n){return n.fold(function(n){return Pn(A.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Ln(u.map(function(n){return n.bind(e)}))},mapResult:function(e){return Ln(u.map(function(n){return n.map(e)}))},mapError:function(e){return Ln(u.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return u.map(function(n){return n.fold(e,t)})},withTimeout:function(n,o){return Ln(jn(function(e){var t=!1,r=setTimeout(function(){t=!0,e(A.error(o()))},n);u.get(function(n){t||(clearTimeout(r),e(n))})}))}})},An=function(n){return Ln(Pn(A.value(n)))},Mn={nu:$,wrap:Ln,pure:An,value:An,error:function(n){return Ln(Pn(A.error(n)))},fromResult:function(n){return Ln(Pn(n))},fromFuture:function(n){return Ln(n.map(A.value))},fromPromise:function(n){return $(function(e){n.then(function(n){e(A.value(n))},function(n){e(A.error(n))})})}},Cn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}},Nn={fromHtml:function(n,e){e=(e||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return Cn(e.childNodes[0])},fromTag:function(n,e){n=(e||document).createElement(n);return Cn(n)},fromText:function(n,e){n=(e||document).createTextNode(n);return Cn(n)},fromDom:Cn,fromPoint:function(n,e,t){return S.from(n.dom.elementFromPoint(e,t)).map(Cn)}},Bn=function(){return zn(0,0)},zn=function(n,e){return{major:n,minor:e}},Gn={nu:zn,detect:function(n,e){e=String(e).toLowerCase();return 0===n.length?Bn():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};n=function(n){return Number(e.replace(t,"$"+n))};return zn(n(1),n(2))}(n,e)},unknown:Bn},Jn=function(n,t){return nn(n,t).map(function(n){var e=Gn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Vn=function(n,t){return nn(n,t).map(function(n){var e=Gn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},qn=function(n,e){return t=n,n=0,""===(e=e)||t.length>=e.length&&t.substr(n,n+e.length)===e;var t},Hn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Wn=function(e){return function(n){return en(n,e)}},n=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return en(n,"edge/")&&en(n,"chrome")&&en(n,"safari")&&en(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Hn],search:function(n){return en(n,"chrome")&&!en(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return en(n,"msie")||en(n,"trident")}},{name:"Opera",versionRegexes:[Hn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Wn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Wn("firefox")},{name:"Safari",versionRegexes:[Hn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(en(n,"safari")||en(n,"mobile/"))&&en(n,"applewebkit")}}],k=[{name:"Windows",search:Wn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return en(n,"iphone")||en(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Wn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Wn("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Wn("linux"),versionRegexes:[]},{name:"Solaris",search:Wn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Wn("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Wn("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Kn={browsers:l(n),oses:l(k)},Xn="Firefox",Yn=function(n){var e=n.current,t=n.version,n=function(n){return function(){return e===n}};return{current:e,version:t,isEdge:n("Edge"),isChrome:n("Chrome"),isIE:n("IE"),isOpera:n("Opera"),isFirefox:n(Xn),isSafari:n("Safari")}},$n={unknown:function(){return Yn({current:void 0,version:Gn.unknown()})},nu:Yn,edge:l("Edge"),chrome:l("Chrome"),ie:l("IE"),opera:l("Opera"),firefox:l(Xn),safari:l("Safari")},Zn="Windows",Qn="Android",ne="Solaris",ee="FreeBSD",te="ChromeOS",re=function(n){var e=n.current,t=n.version,n=function(n){return function(){return e===n}};return{current:e,version:t,isWindows:n(Zn),isiOS:n("iOS"),isAndroid:n(Qn),isOSX:n("OSX"),isLinux:n("Linux"),isSolaris:n(ne),isFreeBSD:n(ee),isChromeOS:n(te)}},oe={unknown:function(){return re({current:void 0,version:Gn.unknown()})},nu:re,windows:l(Zn),ios:l("iOS"),android:l(Qn),linux:l("Linux"),osx:l("OSX"),solaris:l(ne),freebsd:l(ee),chromeos:l(te)},ue=function(n,e){var t,r,o=Kn.browsers(),u=Kn.oses(),i=Jn(o,n).fold($n.unknown,$n.nu),a=Vn(u,n).fold(oe.unknown,oe.nu);return{browser:i,os:a,deviceType:(t=i,r=n,o=e,i=(u=a).isiOS()&&!0===/ipad/i.test(r),n=u.isiOS()&&!i,e=u.isiOS()||u.isAndroid(),a=e||o("(pointer:coarse)"),o=i||!n&&e&&o("(min-device-width:768px)"),e=n||e&&!o,r=t.isSafari()&&u.isiOS()&&!1===/safari/i.test(r),{isiPad:l(i),isiPhone:l(n),isTablet:l(o),isPhone:l(e),isTouch:l(a),isAndroid:u.isAndroid,isiOS:u.isiOS,isWebView:l(r),isDesktop:l(!e&&!o&&!r)})}},ie=(hn=!(mn=function(){return ue(navigator.userAgent,tn)}),function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return hn||(hn=!0,pn=mn.apply(null,n)),pn}),ae=(gn=1,function(n){return n.dom.nodeType===gn}),I=Sn(Element.prototype.attachShadow)&&Sn(Node.prototype.getRootNode),fe=l(I),ce=function(n){return N(n.dom.shadowRoot)},se=function(n){n=n.dom.body;if(null==n)throw new Error("Body is not available yet");return Nn.fromDom(n)},le=function(n,e,t,r){n.dom.removeEventListener(e,t,r)},de=s,me="oxide",pe=[me,"oxide-dark"],yn=function(i){if(!Tn(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var a=[],t={};return J(i,function(n,r){var e=E(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],u=n[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!Tn(u))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.length;if(e!==u.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+u.length+" ("+u+"), got "+e);return{fold:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(n.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+n.length);return n[r].apply(null,t)},match:function(n){var e=E(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t))return!1;return!0}(a,function(n){return B(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,t)},log:function(n){console.log(n,{constructors:a,constructor:o,params:t})}}}}),t},he=yn([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ge=he.strict,ve=he.asOption;(bn=vn=vn||{})[bn.Error=0]="Error",bn[bn.Value=1]="Value";function ye(n,e,t){return n.stype===vn.Error?e(n.serror):t(n.svalue)}function be(n){return{stype:vn.Value,svalue:n}}function we(n){return{stype:vn.Error,serror:n}}var Oe=function(n){return ye(n,A.error,A.value)},Te=be,xe=function(n){var e=[],t=[];return J(n,function(n){ye(n,function(n){return t.push(n)},function(n){return e.push(n)})}),{values:e,errors:t}},Se=we,Fe=function(n,e){return n.stype===vn.Value?e(n.svalue):n},Ee=function(n,e){return n.stype===vn.Error?e(n.serror):n},Ue=function(n,e){return n.stype===vn.Value?{stype:vn.Value,svalue:e(n.svalue)}:n},De=function(n,e){return n.stype===vn.Error?{stype:vn.Error,serror:e(n.serror)}:n},_e=Object.prototype.hasOwnProperty,An=function(i){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o,u=n[r];for(o in u)_e.call(u,o)&&(t[o]=i(t[o],u[o]))}return t}},Re=An(function(n,e){return On(n)&&On(e)?Re(n,e):e}),ke=An(function(n,e){return e});yn([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);function Ie(n,e){var t={};return t[n]=e,t}function je(n){return i(Se,W)(n)}function Pe(n){return On(n)&&100<E(n).length?" removed due to size":JSON.stringify(n,null,2)}function Le(n,e){return Se([{path:n,getErrorInfo:e}])}function Ae(t,r,o){return y(r,o).fold(function(){return n=o,e=r,Le(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+Pe(e)});var n,e},Te)}function Me(n,e,t){return e=y(n,e).fold(function(){return t(n)},r),Te(e)}function Ce(i,a,n,f){return n.fold(function(t,e,n,r){function o(n){return n=r.extract(i.concat([t]),f,n),Ue(n,function(n){return Ie(e,f(n))})}function u(n){return n.fold(function(){var n=Ie(e,f(S.none()));return Te(n)},function(n){n=r.extract(i.concat([t]),f,n);return Ue(n,function(n){return Ie(e,f(S.some(n)))})})}return n.fold(function(){return Fe(Ae(i,a,t),o)},function(n){return Fe(Me(a,t,n),o)},function(){return Fe(Te(y(a,t)),u)},function(n){return Fe(function(e,n,t){n=y(e,n).map(function(n){return!0===n?t(e):n});return Te(n)}(a,t,n),u)},function(n){var e=n(a),n=Ue(Me(a,t,l({})),function(n){return Re(e,n)});return Fe(n,o)})},function(n,e){e=e(a);return Te(Ie(n,f(e)))})}function Ne(r){return{extract:function(t,n,e){return Ee(r(e,n),function(n){return e=n,Le(t,function(){return e});var e})},toString:function(){return"val"}}}function Be(r){return{extract:function(n,e,t){return function(e,t,n,r){n=G(n,function(n){return Ce(e,t,n,r)});return rt(n,{})}(n,t,r,e)},toString:function(){return"obj{\n"+G(r,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"}}}function ze(o){return{extract:function(t,r,n){n=G(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return ot(n)},toString:function(){return"array("+o.toString()+")"}}}function Ge(n,e,t){return Oe(function(n,e,t,r){t=e.extract([n],t,r);return De(t,function(n){return{input:r,errors:n}})}(n,e,r,t))}function Je(n){return"Errors: \n"+function(n){n=10<n.length?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return G(n,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()})}(n.errors).join("\n")+"\n\nInput object: "+Pe(n.input)}function Ve(n,e){return it(n,n,ge(),e)}function qe(n,e){return it(n,n,ve(),e)}function He(n,e,t){return it(n,n,(e=e,he.defaultedThunk(l(e))),t)}function We(n){return D(n,function(n,e){return{k:e.replace(/^tinydrive_/,""),v:n}})}function Ke(n){return n.replace(/\\/g,"/")}function Xe(n){return Ke(n).replace(/\/[^\/]*\/?$/,"")}function Ye(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e}function $e(n){return n.bind(r)}function Ze(n){var e,n=(-1!==(n=(e=n).lastIndexOf("."))?e.substr(n):"").substring(1).toLowerCase();return B(pt,n)?S.some("image"):B(ht,n)?S.some("document"):B(gt,n)?S.some("audio"):B(vt,n)?S.some("video"):B(yt,n)?S.some("archive"):S.none()}function Qe(n){switch(n){case"directory":return"directory";case"document":return"document";case"audio":return"audio";case"video":return"video";case"image":return"image";case"archive":return"archive"}}function nt(n){switch(n){case"directory":return S.some("directory");case"document":return S.some("document");case"audio":return S.some("audio");case"video":return S.some("video");case"image":return S.some("image");case"archive":return S.some("archive");default:return S.none()}}var et,tt,rt=function(n,e){n=xe(n);return 0<n.errors.length?je(n.errors):(n=n.values,e=e,0<n.length?Te(Re(e,ke.apply(void 0,n))):Te(e))},ot=function(n){n=xe(n);return 0<n.errors.length?je(n.errors):Te(n.values)},Hn=yn([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),ut=l(Ne(Te)),it=Hn.field,Wn=function(t,r){return Ne(function(n){var e=typeof n;return t(n)?Te(n):Se("Expected type: "+r+" but got: "+e)})},at=Wn(Fn,"number"),ft=Wn(wn,"string"),ct=Wn(xn,"boolean"),st=Wn(Sn,"function"),n=function(n){return it(n,n,ge(),ut())},k=function(n){return Ve(n,at)},I=function(n){return Ve(n,ft)},bn=function(n){return Ve(n,ct)},An=function(n,e){return it(n,n,ge(),ze(e))},yn=function(n){return qe(n,ft)},Hn=function(n,e){return He(n,e,ft)},Wn=[yn("api_key"),yn("demo_files_url"),it(et="demo_files",et,ve(),ut()),yn("service_url"),n("token_provider")],lt=Be(C(C([],Wn),[He("filetypes",[],ze(ft)),qe("max_image_dimension",at),yn("dropbox_app_key"),yn("google_drive_key"),yn("google_drive_client_id"),He("z_index",65535,at),yn("script_url"),yn("css_url"),Hn("skin",me),yn("target")])),dt=Be(C(C([],Wn),[Hn("path","/"),I("name"),n("blob"),He("onprogress",f,st),it("max_image_dimension","maxImageDimension",ve(),at)])),mt=function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];e=Ke(n).replace(/\/$/,"")+"/"+Ke(e).replace(/^\//,"");return q(t,mt,e)},pt=W(_({"image/gif":["gif"],"image/jpeg":["jpeg","jpg"],"image/png":["png"],"image/tiff":["tif","tiff"],"image/bmp":["bmp"]})),ht=W(_({"application/msword":["doc"],"application/vnd.ms-excel":["xls"],"application/vnd.ms-powerpoint":["ppt","pps"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/pdf":["pdf"],"application/rtf":["rtf"],"text/plain":["txt"],"application/x-iwork-keynote-sffkey":["key"],"application/x-iwork-pages-sffpages":["pages"],"application/x-iwork-numbers-sffnumbers":["numbers"]})),gt=W(_({"audio/wav":["wav","wave"],"audio/mpeg":["mp3"],"audio/ogg":["ogg","oga","ogx","ogm","spx","opus"]})),vt=W(_({"video/mp4":["mp4","m4v"],"video/ogg":["ogv"],"video/webm":["webm"],"video/quicktime":["mov"]})),yt=W(_({"application/zip":["zip"]}));(n=tt=tt||{}).JSON="json",n.Blob="blob",n.Text="text",n.FormData="formdata",n.MultipartFormData="multipart/form-data";function bt(n){return{type:tt.JSON,data:n}}function wt(t){return jn(function(e){var n=new FileReader;n.onload=function(n){n=n.target?n.target.result:"";e(n)},n.readAsText(t)})}function Ot(n){try{var e=JSON.parse(n);return A.value(e)}catch(n){return A.error("Response was not JSON.")}}function Tt(n){return Pn(n.response)}function xt(n,e){switch(n){case tt.JSON:return Ot(e.response).fold(function(){return Tt(e)},Pn);case tt.Blob:return t=e,S.from(t.response).map(wt).getOr(Pn("no response content"));case tt.Text:default:return Tt(e)}var t}function St(n,e){function t(){return Mn.pure(e.response)}function r(n){return Mn.error({message:n,status:e.status,responseText:e.responseText})}switch(n){case tt.JSON:return Ot(e.response).fold(r,Mn.pure);case tt.Blob:case tt.Text:return t();default:return r("unknown data type")}}function Ft(n){var e=(o=n.body,S.from(o).bind(function(n){switch(n.type){case tt.JSON:return S.some("application/json");case tt.FormData:return S.some("application/x-www-form-urlencoded; charset=UTF-8");case tt.MultipartFormData:return S.none();case tt.Text:default:return S.some("text/plain")}})),t=!0===n.credentials?S.some(!0):S.none(),r=function(n){switch(n){case tt.Blob:return"application/octet-stream";case tt.JSON:return"application/json, text/javascript";case tt.Text:return"text/plain";default:return""}}(n.responseType)+", */*; q=0.01",o=void 0!==n.headers?n.headers:{};return{contentType:e,responseType:function(n){switch(n){case tt.JSON:return S.none();case tt.Blob:return S.some("blob");case tt.Text:return S.some("text");default:return S.none()}}(n.responseType),credentials:t,accept:r,headers:o,progress:Sn(n.progress)?S.some(n.progress):S.none()}}function Et(n){var t=new FormData;return m(n,function(n,e){t.append(e,n)}),t}function Ut(i){return Mn.nu(function(r){var t,o=new XMLHttpRequest;o.open(i.method,(t=i.url,S.from(i.query).map(function(n){var e=v(n,function(n,e){return encodeURIComponent(e)+"="+encodeURIComponent(n)}),n=en(t,"?")?"&":"?";return 0<e.length?t+n+e.join("&"):t}).getOr(t)),!0);var u,n=Ft(i);u=o,(n=n).contentType.each(function(n){return u.setRequestHeader("Content-Type",n)}),u.setRequestHeader("Accept",n.accept),n.credentials.each(function(n){return u.withCredentials=n}),n.responseType.each(function(n){return u.responseType=n}),n.progress.each(function(e){return u.upload.addEventListener("progress",function(n){return e(n.loaded,n.total)})}),m(n.headers,function(n,e){return u.setRequestHeader(e,n)});function e(){var e,n,t;e=i.url,n=i.responseType,xt(n,t=o).map(function(n){return{message:0===t.status?"Unknown HTTP error (possible cross-domain request)":"Could not load url "+e+": "+t.statusText,status:t.status,responseText:n}}).get(function(n){return r(A.error(n))})}o.onerror=e,o.onload=function(){0===o.status&&!qn(i.url,"file:")||o.status<100||400<=o.status?e():St(i.responseType,o).get(r)},n=i.body,S.from(n).map(function(n){return n.type===tt.JSON?JSON.stringify(n.data):n.type===tt.FormData||n.type===tt.MultipartFormData?Et(n.data):n.data}).fold(function(){return o.send()},function(n){o.send(n)})})}function Dt(){return{type:tt.Text,data:""}}function _t(n){return Ut(M(M({},n),{method:"post"}))}function Rt(n,t,r){return n.sort(function(n,e){if("name"===t)return"desc"===r?e.name.localeCompare(n.name):n.name.localeCompare(e.name);if("size"===t)return"desc"===r?e.size-n.size:n.size-e.size;n=n.modificationDate.getTime(),e=e.modificationDate.getTime();return"desc"===r?e-n:n-e})}function kt(n,e,t){return n=function(n,e){for(var t=[],r=[],o=0,u=n.length;o<u;o++){var i=n[o];(e(i,o)?t:r).push(i)}return{pass:t,fail:r}}(n,function(n){return"directory"===n.type}),Rt(n.pass,e,t).concat(Rt(n.fail,e,t))}function It(n){return{type:"",message:n}}function jt(n){return{type:"",message:n.message}}function Pt(){return n="file",e=(new Date).getTime(),n+"_"+Math.floor(1e9*Math.random())+ ++rr+String(e);var n,e}function Lt(e,t){var n,r,o;return(n=e.files,r=e.parentUuid,o=t,H(n,function(t){return r.fold(function(){return t.parentUuid.isNone()&&t.name===o},function(e){return t.parentUuid.exists(function(n){return n===e&&t.name===o})})})).fold(function(){var n={uuid:Pt(),type:"directory",parentUuid:e.parentUuid,name:t,size:0,modificationDate:new Date,url:S.none(),thumbUrl:S.none(),starred:!1,path:S.none()};return{files:e.files.concat([n]),parentUuid:S.some(n.uuid)}},function(n){return{files:e.files,parentUuid:S.some(n.uuid)}})}function At(n,e){return q(V(e.split("/"),function(n){return 0<n.length}),Lt,{files:n,parentUuid:S.none()})}function Mt(n){return n=n,S.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2}) ([0-9]{2})\:([0-9]{2})\:([0-9]{2})$/.exec(n)).map(function(n){n=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+"Z");return new Date(n)})}function Ct(n){return S.from(n.split(".")[1]).map(function(n){return JSON.parse(window.atob(n))})}function Nt(n,e){n.set(ke(n.get(),{files:e}))}function Bt(n,e){n.set(ke(n.get(),{meta:ke(n.get().meta,e)}))}function zt(a,n){var f={},t=q(n,function(n,e){var t,r=Fn(e.size)?Ze(e.name).getOr("document"):"directory",o=e.size||0,u=wn(e.date)?Mt(e.date).getOr(new Date):new Date,i=e.uuid||Pt(),o={uuid:i,type:r,parentUuid:S.from(e.parentUuid),name:e.name,size:o,modificationDate:u,url:S.from(e.url),thumbUrl:S.from(e.thumbUrl),starred:!0===e.starred,path:S.none()};return f[i]=(t=a,i=(u=e).meta||{},u=S.from(i.createdBy).orThunk(function(){return Ct(t).map(function(n){return n.name})}),{description:i.description||"",createdBy:u}),function(n,e,t){e=At(n,e);return e.files.concat([ke(t,{parentUuid:e.parentUuid})])}(n,e.path,o)},[]),r=Ct(a).bind(function(n){return Ge("claims",or,n).toOptional()}).getOr({name:"",sub:"",root:S.none()});return r.root.fold(function(){return{files:t,meta:f,claims:r,rootUuid:S.none()}},function(n){var e=At(t,n),n=e.parentUuid;return{files:e.files,meta:f,claims:r,rootUuid:n}})}function Gt(n,r){var o=a({files:[],meta:{},claims:{name:"",sub:"",root:S.none()},rootUuid:S.none()});return function(){return n.jwtTokenFactory(!1).bindFuture((t=n.requestDelay,function(e){return jn(function(n){setTimeout(function(){n(A.value(e))},t)})})).mapError(jt).bindFuture(function(e){return r.mapResult(function(n){return 0<o.get().files.length||o.set(zt(e,n)),o})});var t}}function Jt(n,e){return n.parentUuid.bind(function(n){return ur(n,e)})}function Vt(n,e){return ke(n,{path:e})}function qt(n,e){return Vt(n,S.some(function(n,e){for(var t=[],r=Jt(n,e);r.isSome();r=r.bind(function(n){return Jt(n,e)}))r.each(function(n){return t.push(n)});return"/"+G(t.reverse(),function(n){return n.name}).concat([n.name]).join("/")}(n,e)))}function Ht(n,e){return n.query.fold(s,function(n){return-1!==e.name.toLowerCase().indexOf(n.toLowerCase())})}function Wt(n,e){return 0===n.fileTypes.length||z(n.fileTypes,function(n){return n===e.type})}function Kt(u,i,a,f,n){return Mn.nu(function(r){var o=n.or(u.get().rootUuid);Ze(a).fold(function(){return r(A.error({type:"",message:'Invalid file extension for "'+a+'"'}))},function(n){var e=Pt(),t={uuid:e,type:n,parentUuid:o,name:a,size:i.size,modificationDate:new Date,url:S.some(URL.createObjectURL(i)),thumbUrl:f.map(function(n){return URL.createObjectURL(n)}),starred:!1,path:S.none()};Bt(u,((n={})[e]={description:"",createdBy:S.some(u.get().claims.name)},n)),Nt(u,u.get().files.concat([t])),r(A.value(t))})})}function Xt(a){return function(i){return Mn.nu(function(n){var t,r,e,o,u;t=function(n,e){e=Math.round(i.size*(n/e));a({name:i.name,uuid:i.uuid,loaded:e,total:i.size})},r=function(){n(A.value(i))},o=e=10,(u=function(n,e){setTimeout(function(){e<n?(t(e,n),u(n,e+1)):(t(e,n),r())},o)})(e,0)})}}function Yt(n,e){var t,r=At(n.get().files,(t=e,n.get().claims.root.map(function(n){return mt(n,t.path)}).getOr(t.path)));return Nt(n,r.files),Kt(n,e.blob,e.name,e.thumbBlob,r.parentUuid).bindFuture(Xt(e.progress))}function $t(a,n){function u(n,t,r){var e=S.from(n.get().meta[t]).fold(function(){var n={};return n[t]=M({description:"",createdBy:S.none()},r),n},function(n){var e={};return e[t]=ke(n,r),e});Bt(n,ke(n.get().meta,e))}function f(n,e){return n.claims.root.map(function(t){return e.path.exists(function(n){return t===n||(e=t,0===mt(n,"/").indexOf(mt(e,"/")));var e})}).getOr(!0)}var t,r,c=(t=Gt(a,n),r=a,function(e){return t().mapResult(function(n){return r.log&&console.log("memfs:",e,n.get().claims),n})}),s=function(n,e){return G(n,function(n){return e.fold(l(n),function(r){return Vt(n,n.path.map(function(n){var e,t;return"/"+(qn(e=n,t=r+"/")?(n=e,t=t.length,n.substring(t)):e)}))})})};return{rename:function(o,u){return c("rename").bindFuture(function(r){return Mn.nu(function(e){var n,t;Nt(r,G(r.get().files,function(n){return n.uuid===o?ke(n,{name:u}):n})),X((n=r.get().files,t=[o],V(n,function(n){return B(t,n.uuid)}))).fold(function(){return e(A.error({type:"error",message:"File not found"}))},function(n){return e(A.value(n.uuid))})})})},mkdir:function(a,f){return c("mkdir").bindFuture(function(i){return Mn.nu(function(n){var e,t,r,o,u=Pt(),e={uuid:u,type:"directory",parentUuid:wn(f)?(e=f,t=i,S.from(e).or(t.get().rootUuid)):S.none(),name:a,size:0,modificationDate:new Date,url:S.none(),thumbUrl:S.none(),starred:!1,path:S.none()};t=i.get().files,r=S.from(f),o=a,z(V(t,function(n){return r.fold(function(){return n.parentUuid.isNone()},function(e){return n.parentUuid.exists(function(n){return n===e})})}),function(n){return"directory"===n.type&&n.name===o})?n(A.error({type:"x",message:"Directory already exists"})):(Nt(i,i.get().files.concat([e])),n(A.value(u)))})})},upload:function(e){return c("upload").bindFuture(function(n){return Kt(n,(n=e).blob,n.name,n.thumbBlob,n.parent).bindFuture(Xt(n.progress))})},list:function(u){return c("list").bindFuture(function(o){return Mn.nu(function(n){var e=V(o.get().files,function(n){return e=u,t=n,r=o.get().rootUuid,e.parentUuid.fold(function(){return r.fold(function(){return t.parentUuid.isNone()},function(e){return t.parentUuid.exists(function(n){return n===e})})},function(e){return t.parentUuid.exists(function(n){return n===e})})&&Ht(u,n)&&Wt(u,n);var e,t,r}),t=kt(e,u.sortBy,u.sortOrder),r=t.slice(u.offset,u.offset+a.limit),e=u.offset+r.length;n(A.value({last:e>=t.length,offset:e,files:r}))})})},listStarred:function(i){return c("listStarred").bindFuture(function(u){return Mn.nu(function(n){var e=u.get().claims.root,t=K(u.get().files,function(n){var e=qt(n,u.get().files);return f(u.get(),e)&&Ht(i,e)&&Wt(i,n)&&!0===e.starred?[e]:[]}),r=kt(t,i.sortBy,i.sortOrder),o=r.slice(i.offset,i.offset+a.limit),t=i.offset+o.length;n(A.value({last:t>=r.length,offset:t,files:s(o,e)}))})})},search:function(i){return c("search").bindFuture(function(u){return Mn.nu(function(n){var e=u.get().claims.root,t=K(u.get().files,function(n){var e=qt(n,u.get().files);return f(u.get(),e)&&Ht(i,e)&&Wt(i,n)&&"directory"!==n.type?[e]:[]}),r=kt(t,i.sortBy,i.sortOrder),o=r.slice(i.offset,i.offset+a.limit),t=i.offset+o.length;n(A.value({last:t>=r.length,offset:t,files:s(o,e)}))})})},remove:function(t){return c("remove").bindFuture(function(e){return Mn.nu(function(n){Nt(e,K(e.get().files,function(n){return B(t,n.uuid)?[]:[n]})),n(A.value(t))})})},copy:function(r,o){return c("copy").bindFuture(function(t){return Mn.nu(function(n){var e=Pt();Nt(t,K(t.get().files,function(n){return n.uuid===r?[n,ke(n,{uuid:e,parentUuid:S.from(o)})]:[n]})),t.get().meta[r]&&u(t,e,t.get().meta[r]),n(A.value(e))})})},move:function(t,r){return c("move").bindFuture(function(e){return Mn.nu(function(n){Nt(e,G(e.get().files,function(n){return B(t,n.uuid)?ke(n,{parentUuid:S.from(r)}):n})),n(A.value(t))})})},star:function(t){return c("star").bindFuture(function(e){return Mn.nu(function(n){Nt(e,G(e.get().files,function(n){return B(t,n.uuid)?ke(n,{starred:!0}):n})),n(A.value(t))})})},unstar:function(t){return c("unstar").bindFuture(function(e){return Mn.nu(function(n){Nt(e,G(e.get().files,function(n){return B(t,n.uuid)?ke(n,{starred:!1}):n})),n(A.value(t))})})},setMeta:function(r,o){return c("setMeta").bindFuture(function(t){return Mn.nu(function(e){ur(r,t.get().files).fold(function(){return e(A.error({type:"error",message:"No file!!"}))},function(n){u(t,r,{description:o.description}),e(A.value(n.uuid))})})})},getMeta:function(r){return c("getMeta").bindFuture(function(t){return Mn.nu(function(e){ur(r,t.get().files).fold(function(){return e(A.error({type:"error",message:"No file!!"}))},function(){var n=t.get().meta[r];e(A.value(n||{description:"",createdBy:S.none()}))})})})},uploadToPath:function(e){return c("uploadToPath").bindFuture(function(n){return Yt(n,e)})}}}function Zt(n,e){return e&&!/^https?:/.test(e)?mt(n,e):e}function Qt(n,t){var e=Mn.wrap((e={url:t,responseType:tt.JSON},Ut(M(M({},e),{method:"get",body:Dt()})).map(function(n){return n.fold(function(n){return A.error({type:"",message:"fs error"})},function(n){return A.value((e=Xe(t),n=n.files,G(n,function(n){return M(M({},n),{url:Zt(e,n.url),thumbUrl:Zt(e,n.thumbUrl)})})));var e})})));return $t(n,e.toCached())}function nr(r,o){return o(!1).bindFuture(function(n){return r(n).bind(function(n){return n.fold((e=o,t=r,function(n){return 401===n.status?e(!0).bindFuture(t):Mn.error(n)}),Mn.pure);var e,t})})}function er(e,n){return nr(function(n){return _t(M(M({},e),{headers:function(n,e){e={Authorization:"Bearer "+e};return n?M(M({},n),e):e}(e.headers,n)}))},n)}var tr,rr=0,or=Be([I("name"),I("sub"),yn("root"),it("https://claims.tiny.cloud/drive/root","root",ve(),ft)]),ur=function(e,n){return H(n,function(n){return n.uuid===e})};(_=tr=tr||{}).Thumbnail="thumbnail",_.File="file";function ir(n,e,t){return Ge(n,e,t.data)}function ar(n){return e=X(n.thumbs),t=n.url,n=function(n,e){return e+"-"+n},e.isSome()&&t.isSome()?S.some(n(e.getOrDie(),t.getOrDie())):S.none();var e,t}function fr(n){return{uuid:n.id,parentUuid:S.none(),name:n.name,size:n.size,type:(e=n.type,nt(e).getOr("document")),modificationDate:(e=n.mdate,S.from(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})T([0-9]{2})\:([0-9]{2})\:([0-9]{2})Z$/.exec(e)).map(function(n){n=G(n.slice(1),function(n){return parseInt(n,10)});return new Date(Date.UTC(n[0],n[1]-1,n[2],n[3],n[4],n[5]))}).getOr(new Date)),url:n.url,thumbUrl:ar(n),starred:n.starred,path:n.path};var e}function cr(n,e,t,r){return{last:e,offset:t,files:G(n,fr)}}function sr(n,t){return n=p(n,function(n,e){return t[e](n)}),n=g(n,function(n){return n.isSome()}).t,n=p(n,function(n){return n.fold(function(){return null},r)}),bt(n)}var lr,dr=bt,n=Be([I("id"),I("name"),k("size"),I("type"),I("mdate"),yn("url"),An("thumbs",ft),bn("starred"),yn("path")]),mr=Be([Ve("file",n)]),pr=Be([An("id",ft)]);(_=lr=lr||{}).Thumbnail="thumbnail",_.File="file";function hr(n){return sr(n,{fileType:S.some,parent:r,path:r,name:S.some,size:S.some})}function gr(n){return n=n=q(n,function(n,e){return n[e.name]=e.value,n},{}),{type:tt.MultipartFormData,data:n}}function vr(n){return ir("create",ho,n)}function yr(n){return ir("error",go,n).fold(function(){return ir("error",vo,n).map(function(n){return{error:{type:S.none(),data:S.none(),message:n.message}}})},function(n){return A.value(n)})}function br(n){return sr(n,{offset:S.some,parent:r,sortBy:r,sortOrder:r,query:r,fileTypes:S.some})}function wr(n){return ir("fileListResult",yo,n)}function Or(n,e){return cr(e.files,e.last,e.offset)}function Tr(e){return yr(bt(e.responseText)).fold(function(n){return{type:"",message:"Error: "+e.message+" ("+e.status+")"}},function(n){return{type:"",message:n.error.message}})}function xr(n){return{type:"",message:"Could not decode http json response"}}function Sr(n,e,t){var r,n=er({url:(r=e,mt((e=n).restApiEndpoint,"/1",r)+"?apiKey="+encodeURIComponent(e.apiKey)),body:t,responseType:tt.JSON},n.jwtTokenFactory);return Mn.wrap(n.foldResult(function(n){return A.error(Tr(n))},function(n){return A.value(bt(n))}))}function Fr(n){return G(n,Qe)}function Er(n,e,t){return Sr(n,"client/files/stars",(e={offset:e.offset,sortBy:S.some(e.sortBy),sortOrder:S.some(e.sortOrder),query:e.query,fileTypes:Fr(e.fileTypes)},sr(e,{offset:S.some,sortBy:r,sortOrder:r,query:r,fileTypes:S.some}))).bindResult(function(n){return ir("starsResult",Do,n).fold(function(n){return A.error(xr())},function(n){return A.value((S.none(),cr((n=n).files,n.last,n.offset)))})})}function Ur(n,e,t){return Sr(n,"client/files/mkdir",sr({parent:e,name:t},{parent:r,name:S.some})).bindResult(function(n){return ir("mkdir",wo,n).fold(function(n){return A.error(xr())},function(n){return A.value(n.file.id)})})}function Dr(n,e,t){return Sr(n,"client/files/rename",xo({id:e,name:t})).bindResult(function(n){return ir("rename",So,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function _r(n,e){return Sr(n,"client/files/delete",sr({ids:e},{ids:S.some})).bindResult(function(n){return ir("remove",To,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function Rr(n,e,t){return Sr(n,"client/files/commit",dr({id:e,type:t})).bindResult(function(n){return ir("commit",mr,n).fold(function(n){return A.error(xr())},function(n){return A.value(n)})})}function kr(n,e,t,r,o){return Sr(n,"client/files/create",hr({fileType:e,parent:t,path:S.none(),name:r,size:o})).bindResult(function(n){return vr(n).fold(function(n){return A.error(xr())},function(n){return A.value(n)})})}function Ir(n,t,r,e,o){var u=gr(t.formItems);return u.data.file=e,u=_t({url:t.uploadUrl,body:u,responseType:tt.Text,progress:function(n,e){return o({loaded:n,total:e,name:r,uuid:t.id})}}),Mn.wrap(u.foldResult(function(n){return A.error(Tr(n))},function(n){return A.value(t.id)}))}function jr(e,t,r,o,n){return u=e,i=lr.File,a=n,f=r,n=t.size,Sr(u,"client/files/create",hr({fileType:i,parent:S.none(),path:S.some(a),name:f,size:n})).bindResult(function(n){return vr(n).fold(function(n){return A.error(xr())},function(n){return A.value(n)})}).bindFuture(function(n){return Ir(0,n,r,t,o).bindFuture(function(n){return Rr(e,n,tr.File)}).mapResult(function(n){return fr(n.file)})});var u,i,a,f}function Pr(u,n,i){return function(o){return n.fold(function(){return Mn.value(o)},function(n){return e=u,t=n,r=i,n=o.uuid,kr(e,lr.Thumbnail,S.from(n),r,t.size).bindFuture(function(n){return Ir(0,n,r,t,f)}).bindFuture(function(n){return Rr(e,n,tr.Thumbnail)}).mapResult(function(n){return n.file.id}).bindResult(function(n){return A.value(o)});var e,t,r})}}function Lr(n,e,t){return Sr(n,"client/files/move",sr({ids:e,parent:t},{parent:r,ids:S.some})).bindResult(function(n){return ir("move",Oo,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function Ar(n,e,t){return Sr(n,"client/files/copy",sr({id:e,parent:t},{parent:r,id:S.some})).bindResult(function(n){return ir("copy",pr,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function Mr(n,e){return Sr(n,"client/files/star",Eo({ids:e})).bindResult(function(n){return ir("star",Uo,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function Cr(n,e){return Sr(n,"client/files/unstar",_o({ids:e})).bindResult(function(n){return ir("unstar",Ro,n).fold(function(n){return A.error(xr())},function(){return A.value(e)})})}function Nr(n,e,t){return Sr(n,"client/files/setMeta",(t={id:e,description:t.description},sr(t,{id:S.some,description:S.some}))).bindResult(function(n){return ir("setFileMeta",Fo,n).fold(function(n){return A.error(xr())},function(n){return A.value(e)})})}function Br(n,e){return Sr(n,"client/files/getMeta",sr({id:e},{id:S.some})).bindResult(function(n){return ir("getFileMeta",bo,n).fold(function(n){return A.error(xr())},function(n){return A.value({description:n.description,createdBy:n.createdBy})})})}function zr(i){return{rename:function(n,e){return Dr(i,n,e)},mkdir:function(n,e){return Ur(i,S.from(e),n)},upload:function(n){return e=i,t=n.blob,r=n.name,o=n.progress,u=n.parent,kr(e,lr.File,u,r,t.size).bindFuture(function(n){return Ir(0,n,r,t,o).bindFuture(function(n){return Rr(e,n,tr.File)}).mapResult(function(n){return fr(n.file)})}).bindFuture(Pr(i,n.thumbBlob,n.name));var e,t,r,o,u},list:function(n){return Sr(i,"client/files/list",br({offset:(n=n).offset,parent:n.parentUuid,sortBy:S.some(n.sortBy),sortOrder:S.some(n.sortOrder),query:n.query,fileTypes:Fr(n.fileTypes)})).bindResult(function(n){return wr(n).fold(function(n){return A.error(xr())},function(n){return A.value(Or(S.none(),n))})})},listStarred:function(n){return Er(i,n)},search:function(n){return Sr(i,"client/files/search",br({offset:(n=n).offset,parent:S.none(),sortBy:S.some(n.sortBy),sortOrder:S.some(n.sortOrder),query:n.query,fileTypes:Fr(n.fileTypes)})).bindResult(function(n){return wr(n).fold(function(n){return A.error(xr())},function(n){return A.value(Or(S.none(),n))})})},remove:function(n){return _r(i,n)},copy:function(n,e){return Ar(i,n,S.from(e))},move:function(n,e){return Lr(i,n,S.from(e))},star:function(n){return Mr(i,n)},unstar:function(n){return Cr(i,n)},setMeta:function(n,e){return Nr(i,n,e)},getMeta:function(n){return Br(i,n)},uploadToPath:function(n){return jr(i,n.blob,n.name,n.progress,n.path).bindFuture(Pr(i,n.thumbBlob,n.name))}}}function Gr(n){var e=n.jwtTokenFactory;return n.demoFilesUrl.fold(function(){return n.demoFiles.fold(function(){return function(n,e,t){e=e.getOrDie("Failed to get service url"),t=t.getOrDie("Failed to get api key");return zr({jwtTokenFactory:n,restApiEndpoint:e,apiKey:t})}(e,n.serviceUrl,n.apiKey)},function(n){return n=n,$t({jwtTokenFactory:e,requestDelay:0,log:!1,limit:30},Mn.pure(n))})},function(n){return Qt({jwtTokenFactory:e,requestDelay:0,log:!1,limit:30},n)})}function Jr(n,e,t){return A.error({message:e,status:n,responseText:t})}function Vr(t,r){return _t({url:t,responseType:tt.JSON,body:bt({})}).bindResult(function(n){return wn(n.token)?(e=n.token,r.set(S.some(e)),A.value(e)):(e=t,r.set(S.none()),Jr(500,'Jwt token provider: "'+e+'" did not return a "token" string property in it\'s JSON response body.',""));var e})}function qr(n,t){return Mn.nu(function(e){n(function(n){t.set(S.some(n.token)),e(A.value(n.token))},function(n){t.set(S.none()),e(Jr(0,n,""))})})}function Hr(n){var e,t,r,o,u,i=a(S.none()),n=n.token_provider;return wn(n)?(o=n,u=i,function(n){return n?Vr(o,u):u.get().fold(function(){return Vr(o,u)},function(n){return Mn.pure(n)})}):Sn(n)?(t=n,r=i,function(n){return n?qr(t,r):r.get().fold(function(){return qr(t,r)},function(n){return Mn.pure(n)})}):(e='Required "tinydrive_token_provider" setting not defined.',function(n){return Mn.fromResult(Jr(0,e,""))})}function Wr(e,t){return e.get().getOrThunk(function(){var n,n=Gr({demoFilesUrl:(n=t).demo_files_url,demoFiles:n.demo_files,jwtTokenFactory:Hr(n),serviceUrl:n.service_url,apiKey:n.api_key});return e.set(S.some(n)),n})}function Kr(n,e){return{zIndex:e.z_index,fileTypes:function(n){n=Ye(G(n,nt));return 0<n.length?["directory"].concat(n):[]}(e.filetypes),maxImageDimension:e.max_image_dimension,dropboxAppKey:e.dropbox_app_key,googleDriveDeveloperKey:e.google_drive_key,googleDriveClientId:e.google_drive_client_id,target:e.target,insert:!0,close:!0,fullscreen:!0,baseUrl:n}}function Xr(n,t,r,o,u,i,e){var a=Wr(n,u),f=H(_n(document.getElementsByTagName("script")),function(n){return/tinydrive.min.js/.test(n.src)}).map(function(n){return n.src.substring(0,n.src.lastIndexOf("/"))}).getOr(""),c=!1,s=S.none(),l=Xe(u.script_url.getOr(f+"/assetmanager.min.js"));return dn({js:l+"/assetmanager.min.js",css:(n=l,f=u.skin,"oxide"===(f=B(pe,f)?u.skin:me)?n+"/assetmanager.min.css":n+"/skins/"+f+".min.css")}).get(function(n){c||n.fold(function(n){e(n)},function(n){var e=M(M({},Kr(l,u)),{insert:t,close:r,fullscreen:o});s=S.some(n(a,e,i))})}),{close:function(){s.fold(function(){c=!0},function(n){return n()})}}}function Yr(e,n,t,r,o,u,i,a){return(t=M(M({},n.get().getOr({})),t),Ge("standalone settings",lt,We(t)).mapError(Je)).fold(function(n){return a(n),{close:f}},function(n){return Xr(e,r,o,u,n,i,a)})}function $r(n,e,t,r,o){return Yr(n,e,t,!0,!0,!1,r,o)}function Zr(n,e,t,r,o){return Yr(n,e,t,!1,!0,!1,u(r),o)}function Qr(n,e,t,r,o){return Yr(n,e,t,!1,!1,!0,u(r),o)}function no(n,e){var t=String(n);if(t.length<e)for(var r=0;r<e-t.length;r++)t="0"+t;return t}function eo(n){return e="%Y-%m-%dT%H:%M:%SZ",u=n,t=new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),r="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),o="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),u="January February March April May June July August September October November December".split(" "),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+t.getFullYear())).replace("%m",no(t.getMonth()+1,2))).replace("%d",no(t.getDate(),2))).replace("%H",""+no(t.getHours(),2))).replace("%M",""+no(t.getMinutes(),2))).replace("%S",""+no(t.getSeconds(),2))).replace("%I",""+((t.getHours()+11)%12+1))).replace("%p",t.getHours()<12?"AM":"PM")).replace("%B",""+u[t.getMonth()])).replace("%b",""+n[t.getMonth()])).replace("%A",""+o[t.getDay()])).replace("%a",""+r[t.getDay()])).replace("%%","%");var e,t,r,o,u}function to(e){return e.url.map(function(n){return{name:e.name,url:n,size:e.size,type:Qe(e.type),mdate:eo(e.modificationDate)}})}function ro(n,e){return Io(document.createElement("canvas"),n,e)}function oo(n){var e=ro(n.width,n.height);return ko(e).drawImage(n,0,0),e}function uo(n){return n.naturalWidth||n.width}function io(n){return n.naturalHeight||n.height}var ao,fo,co,so,lo,mo,po,ho=Be([I("uploadUrl"),I("blobUrl"),An("formItems",Be([I("name"),I("value")])),I("id")]),go=Be([(ao="error",fo=[yn("type"),yn("data"),I("message")],it(ao,ao,ge(),Be(fo)))]),vo=Be([I("message")]),yo=Be([bn("last"),k("offset"),An("files",n)]),bo=Be([I("id"),I("description"),yn("createdBy")]),wo=Be([Ve("file",n)]),Oo=Be([An("ids",ft)]),To=Be([An("ids",ft)]),xo=bt,So=Be([Ve("file",n)]),Fo=Be([I("id")]),Eo=bt,Uo=Be([An("ids",ft)]),Do=Be([bn("last"),k("offset"),An("files",n)]),_o=bt,Ro=Be([An("ids",ft)]),ko=function(n){return n.getContext("2d")},Io=function(n,e,t){return n.width=e,n.height=t,n},jo=window.Promise||(co=window,so=Po.immediateFn||"function"==typeof co.setImmediate&&co.setImmediate||function(n){return setTimeout(n,1)},lo=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(r,n)}},mo=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)},po=function(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(n){if(r)return;r=!0,t(n)}},Po.prototype.catch=function(n){return this.then(null,n)},Po.prototype.then=function(t,r){var o=this;return new Po(function(n,e){Lo.call(o,new No(t,r,n,e))})},Po.all=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var a=Array.prototype.slice.call(1===n.length&&mo(n[0])?n[0]:n);return new Po(function(r,o){if(0===a.length)return r([]);for(var u=a.length,i=function(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){i(e,n)},o)}a[e]=n,0==--u&&r(a)}catch(n){o(n)}},n=0;n<a.length;n++)i(n,a[n])})},Po.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Po?e:new Po(function(n){n(e)})},Po.reject=function(t){return new Po(function(n,e){e(t)})},Po.race=function(o){return new Po(function(n,e){for(var t=0,r=o;t<r.length;t++)r[t].then(n,e)})},Po);function Po(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],po(n,lo(Ao,this),lo(Mo,this))}function Lo(t){var r=this;null!==this._state?so(function(){var n,e=r._state?t.onFulfilled:t.onRejected;if(null!==e){try{n=e(r._value)}catch(n){return void t.reject(n)}t.resolve(n)}else(r._state?t.resolve:t.reject)(r._value)}):this._deferreds.push(t)}function Ao(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void po(lo(e,n),lo(Ao,this),lo(Mo,this))}this._state=!0,this._value=n,Co.call(this)}catch(n){Mo.call(this,n)}}function Mo(n){this._state=!1,this._value=n,Co.call(this)}function Co(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];Lo.call(this,t)}this._deferreds=[]}function No(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function Bo(a){return new jo(function(n,e){function t(){o.removeEventListener("load",u),o.removeEventListener("error",i)}var r=URL.createObjectURL(a),o=new Image,u=function(){t(),n(o)},i=function(){t(),e("Unable to load data of type "+a.type+": "+r)};o.addEventListener("load",u),o.addEventListener("error",i),o.src=r,o.complete&&setTimeout(u,0)})}function zo(t){return new jo(function(n,e){!function(n){var e=n.split(","),n=/data:([^;]+)/.exec(e[0]);if(!n)return S.none();for(var n=n[1],e=e[1],t=atob(e),r=t.length,o=Math.ceil(r/1024),u=new Array(o),i=0;i<o;++i){for(var a=1024*i,f=Math.min(1024+a,r),c=new Array(f-a),s=a,l=0;s<f;++l,++s)c[l]=t[s].charCodeAt(0);u[i]=new Uint8Array(c)}return S.some(new Blob(u,{type:n}))}(t).fold(function(){e("uri is not base64: "+t)},n)})}function Go(n,r,o){return r=r||"image/png",Sn(HTMLCanvasElement.prototype.toBlob)?new jo(function(e,t){n.toBlob(function(n){n?e(n):t()},r,o)}):zo(n.toDataURL(r,o))}function Jo(n,e,t){function r(r,o){return n.then(function(n){return e=r,t=o,n.toDataURL(e=e||"image/png",t);var e,t})}var o=e.type,u=l(o),o=l(t);return{getType:u,toBlob:function(){return jo.resolve(e)},toDataURL:o,toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(e,t){return n.then(function(n){return Go(n,e,t)})},toAdjustedDataURL:r,toAdjustedBase64:function(n,e){return r(n,e).then(function(n){return n.split(",")[1]})},toCanvas:function(){return n.then(oo)}}}function Vo(e,n){return Go(e,n).then(function(n){return Jo(jo.resolve(e),n,e.toDataURL())})}function qo(e){return t=e,new jo(function(n){var e=new FileReader;e.onloadend=function(){n(e.result)},e.readAsDataURL(t)}).then(function(n){return Jo(Bo(e).then(function(n){Ho(n);var e=ro(uo(n),io(n));return ko(e).drawImage(n,0,0),e}),e,n)});var t}var Ho=function(n){URL.revokeObjectURL(n.src)},Wo=(Ko.prototype.readByteAt=function(n){return this.dataView.getUint8(n)},Ko.prototype.read=function(n,e){if(n+e>this.length())return A.error("Read extends past buffer end");for(var t=this.littleEndian?0:-8*(e-1),r=0,o=0;o<e;o++)r|=this.readByteAt(n+o)<<Math.abs(t+8*o);return A.value(r)},Ko.prototype.segment=function(n,e){var t=this.dataView.buffer;return void 0!==n&&void 0!==e?t.slice(n,n+e):void 0!==n?t.slice(n):t},Ko.prototype.length=function(){return this.dataView.byteLength},Ko);function Ko(n){this.littleEndian=!1,this.dataView=new DataView(n)}function Xo(n,e,t,r,o){if(e+t*r>n.length())return A.error("Read would extend past end of buffer");for(var u=[],i=0;i<r;i++){var a=o(n,e+t*i);if(a.isError())return a.map(function(n){return[n]});u.push(a.getOrDie())}return A.value(u)}function Yo(n,e){return n.read(e,1)}function $o(n,e){return n.read(e,2)}function Zo(n,e){return n.read(e,4)}function Qo(n){return A.value(String.fromCharCode(n))}function nu(n){return A.value(2147483647<n?n-4294967296:n)}function eu(n,e){return Zo(n,e).bind(nu)}function tu(n,e){return Yo(n,e).bind(Qo)}function ru(n,e,t){return Xo(n,e,1,t=void 0===t?1:t,tu).map(function(n){return n.join("")})}function ou(n,t){return Zo(n,t).bind(function(e){return Zo(n,t+4).map(function(n){return e/n})})}function uu(n,t){return eu(n,t).bind(function(e){return eu(n,t+4).map(function(n){return e/n})})}function iu(f,o,c,s){function l(e){return function(n){return S.some([e,n])}}function d(n){return n.replace(/\0$/,"").trim()}var m={1:{name:"BYTE",size:1,read:Yo},7:{name:"UNDEFINED",size:1,read:Yo},2:{name:"ASCII",size:1,read:Yo},3:{name:"SHORT",size:2,read:$o},4:{name:"LONG",size:4,read:Zo},5:{name:"RATIONAL",size:8,read:ou},9:{name:"SLONG",size:4,read:eu},10:{name:"SRATIONAL",size:8,read:uu}};return $o(f,o).fold(function(){return A.value({})},function(n){for(var t={},e=0;e<n;e++){var r=function(n){var a=o+2+12*n,n=$o(f,a+0).bind(function(i){return $o(f,a+2).bind(function(u){return Zo(f,a+4).bind(function(n){var e=s[i];if(void 0===e)return A.value(S.none());var t=m[u];if(void 0===t)return A.error("Tag with type number "+u+" was unrecognised.");var r=a+8;if(4<t.size*n){var o=Zo(f,a+8);if(o.isError())return o.map(function(n){return S.none()});r=o.getOrDie()+c}return r+t.size*n>=f.length()?A.error("Invalid Exif data."):(1===n&&void 0!==_u[e]?t.read(f,r).map(function(n){return _u[e][n]}):"ASCII"===t.name?ru(f,r,n).map(d):1===n?t.read(f,r):Xo(f,r,t.size,n,t.read)).map(l(e))})})});if(n.isError())return{value:n.map(function(n){return t})};n.each(function(n){return n.each(function(n){var e=n[0],n=n[1];t[e]=n})})}(e);if("object"==typeof r)return r.value}return A.value(t)})}function au(n){return{Orientation:S.from(n.Orientation).filter(Fn).getOrUndefined(),ImageDescription:S.from(n.ImageDescription).filter(wn).getOrUndefined(),Make:S.from(n.Make).filter(wn).getOrUndefined(),Model:S.from(n.Model).filter(wn).getOrUndefined(),Software:S.from(n.Software).filter(wn).getOrUndefined(),ExifIFDPointer:S.from(n.ExifIFDPointer).filter(Fn),GPSInfoIFDPointer:S.from(n.GPSInfoIFDPointer).filter(Fn)}}function fu(n){var e;return{ExifVersion:(e=n.ExifVersion,wn(e)?e:Tn(e)?G(e,function(n){return Fn(n)?String.fromCharCode(n):""}).join(""):void 0),ColorSpace:S.from(n.ColorSpace).filter(wn).getOrUndefined(),PixelXDimension:S.from(n.PixelXDimension).filter(Fn).getOrUndefined(),PixelYDimension:S.from(n.PixelYDimension).filter(Fn).getOrUndefined(),DateTimeOriginal:S.from(n.DateTimeOriginal).filter(wn).getOrUndefined(),ExposureTime:S.from(n.ExposureTime).filter(Fn).getOrUndefined(),FNumber:S.from(n.FNumber).filter(Fn).getOrUndefined(),ISOSpeedRatings:S.from(n.ISOSpeedRatings).filter(Fn).getOrUndefined(),ShutterSpeedValue:S.from(n.ShutterSpeedValue).filter(Fn).getOrUndefined(),ApertureValue:S.from(n.ApertureValue).filter(Fn).getOrUndefined(),MeteringMode:S.from(n.MeteringMode).filter(wn).getOrUndefined(),LightSource:S.from(n.LightSource).filter(wn).getOrUndefined(),Flash:S.from(n.Flash).filter(wn).getOrUndefined(),FocalLength:S.from(n.FocalLength).filter(Fn).getOrUndefined(),ExposureMode:S.from(n.ExposureMode).filter(wn).getOrUndefined(),WhiteBalance:S.from(n.WhiteBalance).filter(wn).getOrUndefined(),SceneCaptureType:S.from(n.SceneCaptureType).filter(wn).getOrUndefined(),DigitalZoomRatio:S.from(n.DigitalZoomRatio).filter(Fn).getOrUndefined(),Contrast:S.from(n.Contrast).filter(wn).getOrUndefined(),Saturation:S.from(n.Saturation).filter(wn).getOrUndefined(),Sharpness:S.from(n.Sharpness).filter(wn).getOrUndefined()}}function cu(n){var e;return{GPSVersionID:(e=n.GPSVersionID,wn(e)?e:Tn(e)?G(e,function(n){return Fn(n)?""+n:wn(n)?n:""}).join("."):void 0),GPSLatitudeRef:S.from(n.GPSLatitudeRef).filter(wn).getOrUndefined(),GPSLatitude:S.from(n.GPSLatitude).filter(Fn).getOrUndefined(),GPSLongitudeRef:S.from(n.GPSLongitudeRef).filter(wn).getOrUndefined(),GPSLongitude:S.from(n.GPSLongitude).filter(Fn).getOrUndefined()}}function su(n){var e=n.JPEGInterchangeFormat;return void 0!==e&&Fn(e)&&void 0!==(n=n.JPEGInterchangeFormatLength)&&Fn(n)?A.value({JPEGInterchangeFormat:e,JPEGInterchangeFormatLength:n}):A.error("")}function lu(l){return t=l,new jo(function(n){var e=new FileReader;e.onloadend=function(){n(e.result)},e.readAsArrayBuffer(t)}).then(function(n){try{var e=new Wo(n);if($o(e,0).is(65496)){var t=Ru(e),r=t.filter(function(n){return"APP1"===n.name}),o={rawHeaders:t};if(!r.length)return jo.reject("Headers did not include required information");var u=(i=r[0].segment,a=new Wo(i),f=$o(a,0).is(65505)&&ru(a,4,5).map(function(n){return n.toUpperCase()}).is("EXIF\0")?(a.littleEndian=$o(a,10).is(18761),$o(a,12).is(42)?Zo(a,14).map(function(n){return 10+n}):A.error("Invalid Exif data.")):A.error("APP1 marker and EXIF marker cannot be read or not available."),c=f.bind(function(n){return iu(a,n,10,Fu).map(au)}),s=c.bind(function(n){return n.ExifIFDPointer.fold(function(){return A.value(S.none())},function(n){return iu(a,10+n,10,Eu).map(fu).map(S.some)})}),i=c.bind(function(n){return n.GPSInfoIFDPointer.fold(function(){return A.value(S.none())},function(n){return iu(a,10+n,10,Uu).map(cu).map(S.some)})}),{tiff:c,exif:s,gps:i,thumb:f.bind(function(e){return $o(a,e).map(function(n){return e+2+12*n})}).bind(function(n){return Zo(a,n).map(function(n){return n+10})}).bind(function(n){return iu(a,n,10,Du).bind(su).map(function(n){return a.segment(10+n.JPEGInterchangeFormat,n.JPEGInterchangeFormatLength)}).map(S.some)})});return o.tiff=u.tiff.getOrDie(),o.exif=$e(u.exif.toOptional()).getOrNull(),o.gps=$e(u.gps.toOptional()).getOrNull(),o.thumb=$e(u.thumb.toOptional()).getOrNull(),o}return jo.reject("Image was not a jpeg")}catch(n){return jo.reject("Unsupported format or not an image: "+l.type+" (Exception: "+n.message+")")}var i,a,f,c,s});var t}function du(n,e,t){return o=e,u=t,(r=n).toCanvas().then(function(n){return ku(n,o,u).then(function(n){return Vo(n,r.getType())})});var r,o,u}function mu(n,e){return r=e,(t=n).toCanvas().then(function(n){return ju(n,t.getType(),r)});var t,r}function pu(e){return e.toBlob().then(lu).then(function(n){switch(n.tiff.Orientation){case 6:return mu(e,90);case 3:return mu(e,180);case 8:return mu(e,270);default:return e}},function(){return e})}function hu(n,e){return Math.max(n.width/e.width,n.height/e.height)}function gu(r,o){return n=r,Q(function(){return Pu(n).then(function(n){var e=n.naturalWidth,t=n.naturalHeight;return URL.revokeObjectURL(n.src),{width:e,height:t}})}).bindFuture(function(n){return 1<hu(n,o)?(e=r,t=function(n,e){e=hu(n,e);return{width:Math.round(n.width/e),height:Math.round(n.height/e)}}(n,o),Q(function(){return qo(e).then(function(n){return du(n,t.width,t.height)}).then(function(n){return n.toAdjustedBlob(e.type,9)})})):Mn.value(r);var e,t});var n}function vu(n){return Mn.fromPromise(qo(n).then(ie().browser.isIE()?pu:r).then(function(n){return n.toBlob()}))}function yu(n,e){return t=n,e.map(function(n){return gu(t,{width:n,height:n})}).getOr(Mn.pure(t)).bindFuture(vu).bindFuture(function(e){return gu(e,{width:512,height:512}).mapResult(function(n){return{blob:e,thumbBlob:S.some(n)}})}).mapError(It);var t}function bu(n,e){return B(Lu,n.type)?yu(n,e):Mn.pure({blob:n,thumbBlob:S.none()})}function wu(n){return Mn.fromResult(Ge("standalone upload settings",dt,We(n)).mapError(Je))}function Ou(o,n,e){return wu(M(M({},n.get().getOr({})),e)).bindFuture(function(n){var e,t,r=Wr(o,n);return e={fs:r,path:n.path,name:n.name,blob:n.blob,progress:(t=n.onprogress,function(n){var e=n.loaded,n=n.total;t({loaded:e,total:n})}),maxImageDimension:n.maxImageDimension},bu(e.blob,e.maxImageDimension).bindFuture(function(n){return e.fs.uploadToPath({blob:n.blob,thumbBlob:n.thumbBlob,name:e.name,progress:e.progress,path:e.path})}).bindResult(function(n){return A.fromOption(to(n).map(function(n){return{file:n}}),It("Failed to get upload file"))}).mapError(function(n){return n.message})})}function Tu(u,i){function r(n,o){return new j(function(e,t){var r=f,r=n(u,i,o,function(n){r(),e({files:Ye(G(n,to))})},function(n){r(),t(n)}).close})}function e(u,t){return new j(function(n,e){r(function(n,e,t,r,o){return u(n,e,t,function(){r([])},o)},t).then(function(){return n()}).catch(e)})}return{overrideDefaults:function(n){var e,t;t=n,(e=i).get().fold(function(){e.set(S.some(t))},function(n){e.set(S.some(M(M({},n),t)))})},pick:function(n){return r($r,n)},browse:function(n){return e(Zr,n)},start:function(n){return e(Qr,n)},upload:function(n){return r=Ou(u,i,n),new j(function(e,t){r.get(function(n){n.fold(function(n){return t(n)},e)})});var r}}}var xu,Su,Fu={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},Eu={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},Uu={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},Du={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},_u={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{78:"North latitude",83:"South latitude"},GPSLongitudeRef:{69:"East longitude",87:"West longitude"}},Ru=function(n){for(var e=[],t=2;t+2<=n.length();){var r=$o(n,t).toOptional().getOrNull();if(null===r)throw new Error("Invalid Exif data.");if(65488<=r&&r<=65495)t+=2;else{if(65498===r||65497===r)break;var o=$o(n,t+2).toOptional().getOrNull();if(null===o)throw new Error("Invalid Exif data.");o=o+2;65505<=r&&r<=65519&&e.push({hex:r,name:"APP"+(15&r),start:t,length:o,segment:n.segment(t,o)}),t+=o}}return e},ku=function(n,e,t){var r=uo(n),o=io(n),u=e/r,r=t/o,o=!1;(u<.5||2<u)&&(u=u<.5?.5:2,o=!0),(r<.5||2<r)&&(r=r<.5?.5:2,o=!0);r=Iu(n,u,r);return o?r.then(function(n){return ku(n,e,t)}):r},Iu=function(i,a,f){return new jo(function(n){var e=uo(i),t=io(i),r=Math.floor(e*a),o=Math.floor(t*f),u=ro(r,o);ko(u).drawImage(i,0,0,e,t,0,0,r,o),n(u)})},ju=function(n,e,t){var r=ro(n.width,n.height),o=ko(r),u=0,i=0;return 90!==(t=t<0?360+t:t)&&270!==t||Io(r,r.height,r.width),90!==t&&180!==t||(u=r.width),270!==t&&180!==t||(i=r.height),o.translate(u,i),o.rotate(t*Math.PI/180),o.drawImage(n,0,0),Vo(r,e)},Pu=Bo,Lu=["image/jpeg","image/png","image/gif"];xu=a(S.none()),Su=a(S.none()),xu=Tu(Su,xu),F.tinydrive=xu}();