/*!
 * Tiny Mentions plugin
 *
 * Copyright 2010-2021 Tiny Technologies, Inc. All rights reserved.
 *
 * Version: 2.3.0-4
 */
!function(){"use strict";function t(e){return function(t){return typeof t===e}}function y(t){return!(null==t)}function i(t){return function(){return t}}function e(t){return t}function O(t,e){return t===e}function n(t){return parseInt(t,10)}function u(t,e){var n=t-e;return 0==n?0:0<n?1:-1}function r(t,e,n){return{major:t,minor:e,patch:n}}function o(t){var e=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t);return e?r(n(e[1]),n(e[2]),n(e[3])):r(0,0,0)}function c(){return p}var a,l=function(t){return n=typeof(e=t),(null===e?"null":"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n)===a;var e,n},s=t("boolean"),f=t("number"),m=function(){},d=i(!(a="string")),v=i(!0),_=function(t,e){return!!t&&-1===function(t,e){var n=u(t.major,e.major);if(0!==n)return n;var r=u(t.minor,e.minor);if(0!==r)return r;var o=u(t.patch,e.patch);return 0!==o?o:0}(o([t.majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join(".")),o(e))},p={fold:function(t,e){return t()},isSome:d,isNone:v,getOr:e,getOrThunk:g,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:e,orThunk:g,map:c,each:m,bind:c,exists:d,forall:v,filter:function(){return p},toArray:function(){return[]},toString:i("none()")};function g(t){return t()}function h(n){function t(){return o}function e(t){return t(n)}var r=i(n),o={fold:function(t,e){return e(n)},isSome:v,isNone:d,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return h(t(n))},each:function(t){t(n)},bind:e,exists:e,forall:e,filter:function(t){return t(n)?o:p},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o}function E(t,e){return t.dom.is(e,k(t))}function b(t){console.error(t)}function A(t){return t&&"string"==typeof t.id&&"string"==typeof t.name}function P(t){A(t)||b("mentions_fetch didn't produce a valid list of users.")}function C(t,e){var n=E(t,e);return n||b("mentions_complete needs to produce a element that matches selector: "+k(t)),n}function N(r){function n(t,e){return"function"==typeof t?t:e}function t(t,e){var o,i=n(t,e);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r={},n=t.map(function(t){var n;return"function"==typeof t&&(n=t,t=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r===o&&n.apply(void 0,t)}),t}),r=o={};i.apply(void 0,n)}}var e=t(r.getParam("mentions_menu_hover"),m),o=t(r.getParam("mentions_fetch"),function(t,e){e([])}),i=n(r.getParam("mentions_menu_complete"),function(t,e){var n=r.dom.create("span",{class:"mention"});return n.appendChild(r.dom.doc.createTextNode("@"+e.name)),n}),u=n(r.getParam("mentions_menu_cancel"),m);return{hover:e,fetch:o,complete:i,select:t(r.getParam("mentions_select"),m),cancel:u}}function S(o){o.on("SetContent",function(){var t;o.$(k(o),t).prop("contentEditable","false")}),o.on("PreProcess",function(t){var e,n,r;e=t.node,n=t.source_view,(r=o.$(k(o),e)).removeAttr("contenteditable"),n||r.removeAttr(j)}),o.on("ResolveName",function(t){E(o,t.target)&&(t.name="mention")})}var x=h,w=c,T=function(t){return null==t?p:h(t)},L=function(i,u){return new tinymce.util.Promise(function(t,e){var n,r=i.getParam("mentions_css_url"),o=r?r+"/":u+"/css/";T(null===(n=i.ui)||void 0===n?void 0:n.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader).load(o+"mentions.css",t,e)})},k=function(t){return t.getParam("mentions_selector",".mention","string")},j="data-mce-mentions-id",D=function(n,r){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];clearTimeout(o),o=setTimeout(function(){n.apply(this,t)},r)}var o;return t.stop=function(){clearTimeout(o)},t},M=function(){return(M=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function R(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}function H(t,e){for(var n=t.length,r=new Array(n),o=0;o<n;o++){var i=t[o];r[o]=e(i,o)}return r}function V(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}}var U={fromHtml:function(t,e){var n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return V(n.childNodes[0])},fromTag:function(t,e){var n=(e||document).createElement(t);return V(n)},fromText:function(t,e){var n=(e||document).createTextNode(t);return V(n)},fromDom:V,fromPoint:function(t,e,n){return T(t.dom.elementFromPoint(e,n)).map(V)}};"undefined"!=typeof window||Function("return this;")();function F(t,e){t.dom.appendChild(e.dom)}function I(n,r){return{left:n,top:r,translate:function(t,e){return I(n+t,r+e)}}}function $(t,e,n){var r=e.x,o=e.y,i=t.w,u=t.h,c=e.w,a=e.h,l=(n||"").split("");return"b"===l[0]&&(o+=a),"r"===l[1]&&(r+=c),"c"===l[0]&&(o+=ut(a/2)),"c"===l[1]&&(r+=ut(c/2)),"b"===l[3]&&(o-=u),"r"===l[4]&&(r-=i),"c"===l[3]&&(o-=ut(u/2)),"c"===l[4]&&(r-=ut(i/2)),K(r,o,i,u)}function K(t,e,n,r){return{x:t,y:e,w:n,h:r}}function W(t,e,n){var r=tinymce.DOM.getViewPort();r.w-=30,r.h-=30;var o=function(t,e,n,r){for(var o,i=0;i<r.length;i++)if((o=$(t,e,r[i])).x>=n.x&&o.x+o.w<=n.w+n.x&&o.y>=n.y&&o.y+o.h<=n.h+n.y)return r[i];return null}(t,e,r,n);return t=$(t,e,o||n[0]||"bl-tl")}function B(t,e,n,r){var o=q(t,t.dom.getRect(n)),i=tinymce.DOM.getRect(e);i=W(i,o,r),tinymce.DOM.setStyles(e,{position:"absolute",left:i.x,top:i.y})}function q(t,e){var n,r;return t.inline||(n=tinymce.DOM.getPos(t.getContentAreaContainer()),r=it(U.fromDom(t.getDoc())),e.x+=n.x-r.left,e.y+=n.y-r.top),e}function G(t,e){return ct.call(t,e)?T(t[e]):w()}function z(t,e,n){!function(t,e,n){if(!(l(n)||s(n)||f(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")}(t.dom,e,n)}function J(t,e){return r="class",o=e,c=(void 0===(u=null===(i=(n=t).dom.getAttribute(r))?void 0:i)||""===u?[]:u.split(" ")).concat([o]),z(n,r,c.join(" ")),1;var n,r,o,i,u,c}function Q(t,e){void 0!==t.dom.classList?t.dom.classList.add(e):J(t,e)}function X(t,e){t.dom.textContent=e}function Y(t){return"profile"!==t.type?w():x(function(t){var e,n=U.fromTag("div");Q(n,"tox"),Q(n,"tox-mentions__card"),T(t.image).each(function(t){var e=U.fromTag("img");z(e,"src",t),Q(e,"tox-mentions__avatar"),F(n,e)});var r=U.fromTag("div");Q(r,"tox-mentions__container"),F(n,r);var o=U.fromTag("div");return Q(o,"tox-mentions__username"),X(o,null!==(e=t.fullName)&&void 0!==e?e:t.name),F(r,o),T(t.description).map(function(t){var e=U.fromTag("div");Q(e,"tox-mentions__description"),X(e,t),F(r,e)}),n}(t.user))}function Z(e){return function(t){t instanceof window.HTMLElement?e(t):Y(t).each(function(t){return e(t.dom)})}}function tt(o,t,e,n){function i(t,e){var n,r,o,i=f(((n=(n=t.rng).cloneRange()).setStart(n.startContainer,n.startOffset+1),n)),u=W(a.getRect(e.getEl()),(r=0,o=2,K(i.x-r,i.y-o,i.w+2*r,i.h+2*o)),["bl-tl","tl-bl","tl-br","bl-tr"]);e.moveTo(u.x,u.y)}function r(){m(),u&&u.hide()}var u,c,a=tinymce.DOM,l=tinymce.util.Tools,s=-1,f=function(t){var e=t.getClientRects()[0],n=o.inline?a.getViewPort():{x:0,y:0};return q(o,{x:e.left+n.x,y:e.top+n.y,w:e.width,h:e.height})},m=function(){c&&(a.remove(c),c=null)},d=function(){m(),u&&(u.remove(),u=null)},v=function(o){n(o.settings.data,Z(function(t){var e,n,r;o.getEl().parentNode&&0!==u.items().length&&u.visible()&&(a.setStyles(t,{position:"absolute",left:-65535,top:-65535}),a.add(document.body,t),e=t,n=o.getEl(),r=W(a.getRect(e),a.getRect(n),["tr-tl","tl-tr","bl-br","br-bl"]),a.setStyles(e,{left:r.x,top:r.y}),m(),c=t)}))},p=function(n){m(),u.items().each(function(t,e){t===n&&s!==e&&(n.hover(),v(n),s=e)})},g=function(){r();var t=u.items()[s];t&&e(t.settings.data)};return{isVisible:function(){return y(u)&&u.visible()},selectNext:function(){p(u.items()[s+1])},selectPrev:function(){p(u.items()[s-1])},showAt:function(r){t(function(t){var e,n;0!==t.length?(u=(u||(u=tinymce.ui.Factory.create("menu",{onhide:function(){m()},classes:"contextmenu"}).renderTo(),o.on("remove",d),u)).show(),(e=u).getEl().style.width="",e.getEl("body").style.width="",u.items().remove(),u.add((n=r.text,l.map(t,function(t){return{text:t.fullName,data:t,match:n,onclick:function(){p(this),g()},onmouseenter:function(){p(this)}}}))),u.renderNew(),u.initLayoutRect(),i(r,u),s=-1,p(u.items()[0])):u&&u.hide()})},hide:r,complete:g}}function et(t){if(null===t)return null;var e,n=(e=t).collapsed&&3===e.startContainer.nodeType?e.startContainer:null;if(null===n)return null;var r=t.startOffset,o=function(t,e){for(var n=e-1;0<=n;n--){if(at.test(t.charAt(n)))return null;if("@"===t.charAt(n))break}return-1===n||e-n<2?null:t.substring(n+1,e)}(n.data,r);if(null===o)return null;var i=t.cloneRange();return i.setStart(n,r-o.length-1),i.setEnd(n,r),{text:o,rng:i}}function nt(){var t,e,n,r,o=(t=m,e=w(),n=e,r={get:function(){return n},set:function(t){n=t}},{clear:function(){i(),r.set(w())},isSet:function(){return r.get().isSome()},get:function(){return r.get()},set:function(t){i(),r.set(x(t))}});function i(){return r.get().each(t)}return M(M({},o),{on:function(t){return o.get().each(t)}})}function rt(t,e){return _(tinymce,"4.3.13")?(console.error("The mentions plugin requires at least 4.3.13 version of TinyMCE."),m):_(tinymce,"5.0.0")?lt(t):(t.on("init",function(){L(t,e)}),st(t))}var ot=I,it=function(t){var e=void 0!==t?t.dom:document,n=e.body.scrollLeft||e.documentElement.scrollLeft,r=e.body.scrollTop||e.documentElement.scrollTop;return ot(n,r)},ut=Math.round,ct=Object.hasOwnProperty,at=/[\u00a0 \t\r\n]/,lt=function(r){function t(t){if(f.isVisible()&&!u.modifierPressed(t))switch(t.keyCode){case 27:p(t,d);break;case u.UP:p(t,f.selectPrev);break;case u.DOWN:p(t,f.selectNext);break;case u.ENTER:case u.TAB:p(t,f.complete)}else d()}function e(t){t.keyCode===u.BACKSPACE&&v(),t.keyCode!==u.LEFT&&t.keyCode!==u.RIGHT||d()}function n(t){var e=t.element;E(r,e)&&!r.selection.isCollapsed()?a.select(e,function(t){t instanceof window.HTMLElement&&(s(),o=t,document.body.appendChild(t),B(r,t,e,["bl-tl","tl-bl","tl-br","bl-tr"]))}):s()}var o,i=tinymce.util.Tools,u=tinymce.util.VK,c={},a=N(r),l=function(){return et(r.selection.getRng())},s=function(){var t;y(o)&&(t=o.parentNode,y(t)&&t.removeChild(o),o=null)},f=tt(r,function(n){var t,e=l();e&&(t={term:e.text},a.fetch(t,function(t){i.each(t,P);var e=t.slice(0,10);n(i.grep(e,A))}))},function(t){var e,n=a.complete(r,t);C(r,n)&&(e=l(),n.contentEditable="false",n.setAttribute(j,t.id),c[t.id]=t,y(e)&&r.selection.setRng(e.rng),r.insertContent(n.outerHTML))},a.hover),m=function(t){return!!t&&1<=t.text.length},d=function(){f.isVisible()&&a.cancel(),f.hide()},v=function(){var t;r.removed||(t=l(),m(t)?f.showAt(t):d())},p=function(t,e){t.preventDefault(),e()};return S(r),r.on("keypress",D(v,100)),r.on("keydown",t),r.on("keyup",e),r.on("nodechange",n),r.on("remove",s),{getUsers:function(){var e=[],n=i.map(r.dom.select("["+j+"]"),function(t){return t.getAttribute(j)});return i.each(c,function(t){-1!==i.inArray(n,t.id)&&e.push(t)}),e}}},st=function(f){function n(){null!==l&&null!==l.parentNode&&(l.removeEventListener("mouseover",b),l.removeEventListener("mouseout",x),l.parentNode.removeChild(l)),l=null}function t(t){var e=f.dom.$(t.target).closest(k(f));0<e.length&&(s.set(!0),h(e[0]))}function e(t){0<f.dom.$(t.target).closest(k(f)).length&&(s.clear(),w()||g())}function r(t){E(f,t.element)&&!f.selection.isCollapsed()?h(t.element):w()||x()}var o,i,u=tinymce.util.Delay,c=tinymce.util.Tools,a=tinymce.util.Promise,m={},d=N(f),l=null,s=nt(),v=f.getParam("mentions_min_chars",1,"number"),p=f.getParam("mentions_item_type","name","string"),g=function(){n()},y=function(t){return u.clearTimeout(t)},h=function(t){y(o),y(i),o=u.setEditorTimeout(f,function(){var e;e=t,d.select(e,Z(function(t){n(),(l=t).addEventListener("mouseover",b),l.addEventListener("mouseout",x),l.style.position="absolute",l.style.left="-10000px",l.style.top="-10000px",Q(U.fromDom(l),"tox-mentions__card-common"),document.body.appendChild(l),B(f,l,e,["bl-tl","tl-bl","tl-br","bl-tr"])}))},0)},b=function(){y(i)},x=function(){y(i),y(o),i=u.setEditorTimeout(f,g,300)},w=function(){return s.isSet()||E(f,f.selection.getNode())&&!f.selection.isCollapsed()},T=_(tinymce,"5.6.0")||"name"===p?function(t,e){return{type:"autocompleteitem",value:t.id,text:t.name,meta:{user:t,tooltipWorker:e}}}:function(e,t){var n=G(e,"image").map(function(t){return{type:"cardimage",src:t,classes:["tox-mentions__avatar"],alt:e.name}}).toArray(),r=G(e,"description").map(function(t){return{type:"cardtext",text:t,classes:["tox-mentions__description"]}}).toArray();return{type:"cardmenuitem",value:e.id,label:e.name,items:R(R([],n),[{type:"cardcontainer",direction:"vertical",items:R([{type:"cardtext",text:e.name,name:"username",classes:["tox-mentions__username"]}],r)}]),meta:{user:e,tooltipWorker:t}}};return f.ui.registry.addAutocompleter("mentions",{ch:"@",minChars:v,maxResults:10,highlightOn:["username"],onAction:function(t,e,n,r){var o,i,u,c,a,l,s;a=G(r,"reload"),l=!0,void 0===s&&(s=O),a.exists(function(t){return s(t,l)})?(r.reload,o=function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(r,["reload"]),t.reload(o)):(i=r.user,u=e,c=d.complete(f,i),C(f,c)&&(c.contentEditable="false",c.setAttribute(j,i.id),m[i.id]=i,f.selection.setRng(u),f.insertContent(c.outerHTML)),t.hide())},fetch:function(t,e,i){return new a(function(n){var r,o;r=e,o=function(t,e){n(function(t,e){void 0===e&&(e=[]);var n=H(t,function(e){return T(e,function(t){d.hover(e,Z(t))})});if(_(tinymce,"5.0.14"))return n;var r=H(e,function(t){return{value:void 0===t.value?"":t.value,text:t.text,meta:M(M({},t.meta),{reload:!0})}}),o=0<r.length?[{type:"separator"}]:[];return R(R(R([],n),o),r)}(t,e))},d.fetch({term:t,meta:i},function(t,e){c.each(t,P);var n=t.slice(0,r);o(c.grep(n,A),e)})})},columns:1}),S(f),f.on("mouseover",t),f.on("mouseout",e),f.on("nodechange",r),f.on("remove",n),{getUsers:function(){var e=[],n=c.map(f.dom.select("["+j+"]"),function(t){return t.getAttribute(j)});return c.each(m,function(t){-1!==c.inArray(n,t.id)&&e.push(t)}),e}}};tinymce.PluginManager.add("mentions",rt)}();